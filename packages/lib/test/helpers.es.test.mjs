import{expect as r}from"chai";import e from"@bitcoin-computer/bitcore-mnemonic-ltc";import"axios";import"child_process";import"crypto";import"crypto-js";import"eciesjs";import"@endo/static-module-record";import t from"util";import"url";import"fs/promises";const{CHAIN:o,NETWORK:n,BCN_URL:s,RPC_USER:a,RPC_PASSWORD:i,TEST_MNEMONICS:u}=process.env;function c(r){return{smartArgs:r.filter((r=>r._rev)),dumbArgs:r.map((r=>r._rev?"__":r))}}parseInt(process.env.BC_DUST_LIMIT||"",10),e.bitcore,parseInt(process.env.BC_DEFAULT_FEE||"",10),parseInt(process.env.BC_SCRIPT_CHUNK_SIZE||"",10),parseInt(process.env.MWEB_HEIGHT||"",10),e.bitcore,e.bitcore,e.bitcore,e.bitcore;const p=r=>(Object.prototype.toString.call(r).match(/\s([a-zA-Z]+)/)||[])[1];const l=r=>"object"==typeof r?p(r):p(r).toLowerCase();const v=r=>{if((r=>["number","string","boolean","undefined","Null"].includes(l(r)))(r))return r;if((r=>"Array"===l(r))(r))return r.map(v);if((r=>"Object"===l(r))(r)){const e=Object.keys(r).reduce(((e,t)=>(e[t]=v(r[t]),e)),{});const t=Object.create(Object.getPrototypeOf(r));return Object.assign(t,e)}throw new Error(`Unsupported data type for clone: ${l(r)}`)};var f={exports:{}};var b="win32"===process.platform;var m=t;function g(r,e){var t=[];for(var o=0;o<r.length;o++){var n=r[o];n&&"."!==n&&(".."===n?t.length&&".."!==t[t.length-1]?t.pop():e&&t.push(".."):t.push(n))}return t}function h(r){var e=r.length-1;var t=0;for(;t<=e&&!r[t];t++);var o=e;for(;o>=0&&!r[o];o--);return 0===t&&o===e?r:t>o?[]:r.slice(t,o+1)}var d=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/;var w=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/;var _={};function j(r){var e=d.exec(r),t=(e[1]||"")+(e[2]||""),o=e[3]||"";var n=w.exec(o);return[t,n[1],n[2],n[3]]}function A(r){var e=d.exec(r),t=e[1]||"",o=!!t&&":"!==t[1];return{device:t,isUnc:o,isAbsolute:o||!!e[2],tail:e[3]}}function y(r){return"\\\\"+r.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}_.resolve=function(){var r="",e="",t=!1;for(var o=arguments.length-1;o>=-1;o--){var n;if(o>=0?n=arguments[o]:r?(n=process.env["="+r])&&n.substr(0,3).toLowerCase()===r.toLowerCase()+"\\"||(n=r+"\\"):n=process.cwd(),!m.isString(n))throw new TypeError("Arguments to path.resolve must be strings");if(n){var s=A(n),a=s.device,i=s.isUnc,u=s.isAbsolute,c=s.tail;if((!a||!r||a.toLowerCase()===r.toLowerCase())&&(r||(r=a),t||(e=c+"\\"+e,t=u),r&&t))break}}return i&&(r=y(r)),r+(t?"\\":"")+(e=g(e.split(/[\\\/]+/),!t).join("\\"))||"."},_.normalize=function(r){var e=A(r),t=e.device,o=e.isUnc,n=e.isAbsolute,s=e.tail,a=/[\\\/]$/.test(s);return(s=g(s.split(/[\\\/]+/),!n).join("\\"))||n||(s="."),s&&a&&(s+="\\"),o&&(t=y(t)),t+(n?"\\":"")+s},_.isAbsolute=function(r){return A(r).isAbsolute},_.join=function(){var r=[];for(var e=0;e<arguments.length;e++){var t=arguments[e];if(!m.isString(t))throw new TypeError("Arguments to path.join must be strings");t&&r.push(t)}var o=r.join("\\");return/^[\\\/]{2}[^\\\/]/.test(r[0])||(o=o.replace(/^[\\\/]{2,}/,"\\")),_.normalize(o)},_.relative=function(r,e){r=_.resolve(r),e=_.resolve(e);var t=r.toLowerCase();var o=e.toLowerCase();var n=h(e.split("\\"));var s=h(t.split("\\"));var a=h(o.split("\\"));var i=Math.min(s.length,a.length);var u=i;for(var c=0;c<i;c++)if(s[c]!==a[c]){u=c;break}if(0==u)return e;var p=[];for(c=u;c<s.length;c++)p.push("..");return(p=p.concat(n.slice(u))).join("\\")},_._makeLong=function(r){if(!m.isString(r))return r;if(!r)return"";var e=_.resolve(r);return/^[a-zA-Z]\:\\/.test(e)?"\\\\?\\"+e:/^\\\\[^?.]/.test(e)?"\\\\?\\UNC\\"+e.substring(2):r},_.dirname=function(r){var e=j(r),t=e[0],o=e[1];return t||o?(o&&(o=o.substr(0,o.length-1)),t+o):"."},_.basename=function(r,e){var t=j(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},_.extname=function(r){return j(r)[3]},_.format=function(r){if(!m.isObject(r))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof r);var e=r.root||"";if(!m.isString(e))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof r.root);var t=r.dir;var o=r.base||"";return t?t[t.length-1]===_.sep?t+o:t+_.sep+o:o},_.parse=function(r){if(!m.isString(r))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof r);var e=j(r);if(!e||4!==e.length)throw new TypeError("Invalid path '"+r+"'");return{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},_.sep="\\",_.delimiter=";";var E=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var S={};function T(r){return E.exec(r).slice(1)}function C(r,e){let t=0;return e.map((e=>"__"===e?r[t++]:e))}S.resolve=function(){var r="",e=!1;for(var t=arguments.length-1;t>=-1&&!e;t--){var o=t>=0?arguments[t]:process.cwd();if(!m.isString(o))throw new TypeError("Arguments to path.resolve must be strings");o&&(r=o+"/"+r,e="/"===o[0])}return(e?"/":"")+(r=g(r.split("/"),!e).join("/"))||"."},S.normalize=function(r){var e=S.isAbsolute(r),t=r&&"/"===r[r.length-1];return(r=g(r.split("/"),!e).join("/"))||e||(r="."),r&&t&&(r+="/"),(e?"/":"")+r},S.isAbsolute=function(r){return"/"===r.charAt(0)},S.join=function(){var r="";for(var e=0;e<arguments.length;e++){var t=arguments[e];if(!m.isString(t))throw new TypeError("Arguments to path.join must be strings");t&&(r+=r?"/"+t:t)}return S.normalize(r)},S.relative=function(r,e){r=S.resolve(r).substr(1),e=S.resolve(e).substr(1);var t=h(r.split("/"));var o=h(e.split("/"));var n=Math.min(t.length,o.length);var s=n;for(var a=0;a<n;a++)if(t[a]!==o[a]){s=a;break}var i=[];for(a=s;a<t.length;a++)i.push("..");return(i=i.concat(o.slice(s))).join("/")},S._makeLong=function(r){return r},S.dirname=function(r){var e=T(r),t=e[0],o=e[1];return t||o?(o&&(o=o.substr(0,o.length-1)),t+o):"."},S.basename=function(r,e){var t=T(r)[2];return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},S.extname=function(r){return T(r)[3]},S.format=function(r){if(!m.isObject(r))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof r);var e=r.root||"";if(!m.isString(e))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof r.root);return(r.dir?r.dir+S.sep:"")+(r.base||"")},S.parse=function(r){if(!m.isString(r))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof r);var e=T(r);if(!e||4!==e.length)throw new TypeError("Invalid path '"+r+"'");return e[1]=e[1]||"",e[2]=e[2]||"",e[3]=e[3]||"",{root:e[0],dir:e[0]+e[1].slice(0,-1),base:e[2],ext:e[3],name:e[2].slice(0,e[2].length-e[3].length)}},S.sep="/",S.delimiter=":",f.exports=b?_:S,f.exports.posix=S,f.exports.win32=_,describe("helpers",(()=>{describe("splitArgs",(()=>{it("should work for an array of dumb objects",(()=>{r(c([{a:1},{b:2}])).to.deep.eq({dumbArgs:[{a:1},{b:2}],smartArgs:[]})})),it("should work for an array of smart objects",(()=>{r(c([{a:1,_rev:"rev1"},{b:2,_rev:"rev1"}])).to.deep.eq({dumbArgs:["__","__"],smartArgs:[{_rev:"rev1",a:1},{_rev:"rev1",b:2}]})})),it("should work for an array of smart objects",(()=>{r(c([{a:1},{b:2,_rev:"rev1"}])).to.deep.eq({dumbArgs:[{a:1},"__"],smartArgs:[{_rev:"rev1",b:2}]})}))})),describe("mergeArgs",(()=>{it("should work for an array of dumb objects",(()=>{const e=[{a:1}];const t=v(e);r(C(e,["__"])).to.deep.eq([{a:1}]),r(t).to.deep.eq(e)})),it("should work for an array of dumb objects",(()=>{const e=[{a:1},{b:2}];const{smartArgs:t,dumbArgs:o}=c(e);r(C(t,o)).to.deep.eq(e)})),it("should work for an array of smart objects",(()=>{const e=[{a:1,_rev:"rev0"},{b:2,_rev:"rev0"}];const{smartArgs:t,dumbArgs:o}=c(e);r(C(t,o)).to.deep.eq(e)})),it("should work for a mixed array of objects",(()=>{const e=[{a:1},{b:2,_rev:"rev0"}];const{smartArgs:t,dumbArgs:o}=c(e);r(C(t,o)).to.deep.eq(e)}))}))}));
